# 贡献指南

<cite>
**本文档中引用的文件**  
- [CODE_OF_CONDUCT.md](file://CODE_OF_CONDUCT.md)
- [README.md](file://README.md)
- [pyproject.toml](file://pyproject.toml)
- [requirements.txt](file://requirements.txt)
- [.pre-commit-config.yaml](file://third_party/Matcha-TTS/.pre-commit-config.yaml)
- [.pylintrc](file://third_party/Matcha-TTS/.pylintrc)
- [Makefile](file://third_party/Matcha-TTS/Makefile)
</cite>

## 目录
1. [引言](#引言)
2. [行为准则](#行为准则)
3. [代码规范](#代码规范)
4. [贡献流程](#贡献流程)
5. [测试要求](#测试要求)
6. [问题报告与功能请求](#问题报告与功能请求)
7. [社区沟通渠道](#社区沟通渠道)

## 引言
CosyVoice 是一个先进的多语言零样本语音合成系统，基于大型语言模型（LLM）构建，致力于为全球用户提供高质量的文本转语音服务。本项目采用开放源码模式开发，欢迎所有开发者参与贡献。通过遵循本文档中的指南，您可以了解如何为项目做出有效贡献，包括遵守行为准则、遵循代码规范、执行贡献流程、运行测试以及参与社区讨论。

## 行为准则
CosyVoice 项目遵循《贡献者公约行为准则》（Contributor Covenant Code of Conduct），旨在营造一个开放、包容且尊重他人的社区环境。

### 我们的承诺
作为贡献者和维护者，我们承诺确保项目和社区对所有人都是无骚扰体验，无论其年龄、体型、残疾状况、民族、性别特征、性别认同与表达、经验水平、教育背景、社会经济地位、国籍、外貌、种族、宗教或性取向。

### 我们的行为标准
促进积极环境的行为包括：
- 使用欢迎和包容性的语言
- 尊重不同的观点和经历
- 优雅地接受建设性批评
- 关注社区的最佳利益
- 对其他社区成员表现出同理心

不可接受的行为包括：
- 使用性化语言或图像以及不受欢迎的性关注或挑逗
- 恶搞、侮辱/贬损性评论以及人身或政治攻击
- 公开或私下骚扰
- 未经明确许可发布他人的私人信息（如物理或电子地址）
- 在专业场合下可能被视为不适当的行为

### 范围
本行为准则适用于项目空间内以及个人代表项目或其社区时的公共空间。代表项目的行为包括使用官方项目电子邮件地址、通过官方社交媒体账户发帖或作为指定代表参加线上或线下活动。

### 执行
如发现滥用、骚扰或其他不可接受行为，请联系项目团队：mikelei@mobvoi.com。所有投诉将被审查和调查，并根据情况采取必要和适当的回应。项目团队有义务对事件报告者的信息保密。

**Section sources**
- [CODE_OF_CONDUCT.md](file://CODE_OF_CONDUCT.md#L1-L77)

## 代码规范
为了保持代码库的一致性和可维护性，CosyVoice 项目采用了严格的代码规范，并通过自动化工具进行强制执行。

### 代码格式化工具
项目使用 `pre-commit` 钩子来确保每次提交前代码符合规范。`.pre-commit-config.yaml` 文件定义了多个检查步骤，包括：
- **Black**: 自动格式化 Python 代码，确保一致的代码风格
- **isort**: 自动排序导入语句
- **pyupgrade**: 将语法升级到更新的 Python 版本
- **flake8**: 检查 PEP8 规范、编程错误和代码复杂度
- **pylint**: 进行更深入的代码质量分析

### 静态代码分析配置
项目采用 `.pylintrc` 文件配置 `pylint` 的检查规则，主要设置包括：
- 最大行长度为 120 个字符
- 函数/方法的最大参数数量为 5
- 类的最大属性数量为 7
- 函数/方法体内的最大语句数为 50
- 变量、函数和方法命名采用蛇形命名法（snake_case）
- 类命名采用帕斯卡命名法（PascalCase）

这些规则有助于提高代码的可读性和可维护性，同时避免常见的编程陷阱。

**Section sources**
- [.pre-commit-config.yaml](file://third_party/Matcha-TTS/.pre-commit-config.yaml#L1-L60)
- [.pylintrc](file://third_party/Matcha-TTS/.pylintrc#L1-L526)

## 贡献流程
以下是为 CosyVoice 项目贡献代码的标准流程：

### 1. 创建分支
从主分支创建一个新的功能或修复分支：
```bash
git checkout main
git pull origin main
git checkout -b feature/your-feature-name
```

### 2. 编写代码
在新分支上实现您的功能或修复。请确保代码符合项目的编码规范。

### 3. 运行 pre-commit 钩子
在提交代码前，确保已安装并运行 pre-commit 钩子：
```bash
# 安装 pre-commit 钩子
pre-commit install

# 手动运行所有钩子检查
pre-commit run --all-files
```

### 4. 提交代码
使用清晰的提交信息提交您的更改：
```bash
git add .
git commit -m "描述您所做的更改"
```

### 5. 推送分支
将您的分支推送到远程仓库：
```bash
git push origin feature/your-feature-name
```

### 6. 发起 Pull Request
在 GitHub 上创建 Pull Request，详细描述您的更改及其目的。维护者将审查您的代码并提供反馈。

**Section sources**
- [.pre-commit-config.yaml](file://third_party/Matcha-TTS/.pre-commit-config.yaml#L1-L60)
- [Makefile](file://third_party/Matcha-TTS/Makefile#L1-L10)

## 测试要求
为确保代码质量，所有贡献都必须通过相应的测试。

### 单元测试
项目使用 `pytest` 框架进行单元测试。在提交代码前，请确保所有相关测试通过：
```bash
# 运行所有测试
pytest

# 运行特定模块的测试
pytest tests/test_module.py
```

### 集成测试
对于涉及多个组件交互的功能，需要编写集成测试以验证整体行为。测试应覆盖正常路径和异常情况。

### 测试覆盖率
项目鼓励高测试覆盖率。您可以使用 `coverage.py` 工具检查测试覆盖率：
```bash
coverage run -m pytest
coverage report
coverage html  # 生成 HTML 报告
```

**Section sources**
- [Makefile](file://third_party/Matcha-TTS/Makefile#L1-L10)
- [pyproject.toml](file://third_party/Matcha-TTS/pyproject.toml#L27-L37)

## 问题报告与功能请求
我们欢迎您报告问题、提出功能请求和提交文档改进。

### 报告问题
当您遇到 bug 或问题时，请在 GitHub Issues 中创建一个新的 issue。请提供以下信息：
- 问题的详细描述
- 复现步骤
- 预期行为与实际行为
- 系统环境信息（操作系统、Python 版本等）
- 相关错误日志或截图

### 提出功能请求
如果您有新的功能想法，请创建一个 feature request issue。请详细说明：
- 功能的目的和用途
- 使用场景
- 建议的实现方式
- 对现有系统的潜在影响

### 文档改进
文档是项目的重要组成部分。如果您发现文档中的错误或可以改进的地方，请直接提交 Pull Request 进行修改。

**Section sources**
- [README.md](file://README.md#L266-L273)

## 社区沟通渠道
CosyVoice 社区提供多种沟通渠道，方便开发者交流和协作。

### GitHub Issues
主要的讨论和问题跟踪平台：
[GitHub Issues](https://github.com/FunAudioLLM/CosyVoice/issues)

### 钉钉群
扫描以下二维码加入我们的官方钉钉群，与其他开发者实时交流：

<img src="./asset/dingding.png" width="250px">

通过这些渠道，您可以获取最新项目动态、寻求帮助、分享经验并参与社区建设。

**Section sources**
- [README.md](file://README.md#L266-L273)